
{% set title = "Opdrachtbon" %}
<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{{ title }}</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body{background:#f5f6f8}
    .card{border-radius:14px; box-shadow:0 6px 24px rgba(0,0,0,.06);}
  </style>
</head>
<body class="py-4">
<div class="container">
  <div class="card p-4">
    <h3 class="mb-3">Opdrachtbon</h3>
    <form method="post" action="/submit">
      <div class="row g-3">
        <div class="col-md-4">
          <label class="form-label">Kenteken</label>
          <div class="input-group">
            <input id="kenteken" name="kenteken" class="form-control" placeholder="XX-999-X" required>
            <button class="btn btn-primary" type="button" id="rdw-btn">RDW</button>
          </div>
        </div>
        <div class="col-md-4">
          <label class="form-label">Merk</label>
          <input id="merk" name="merk" class="form-control" readonly>
        </div>
        <div class="col-md-4">
          <label class="form-label">Type</label>
          <input id="type" name="type" class="form-control" readonly>
        </div>
        <div class="col-md-3">
          <label class="form-label">Bouwjaar</label>
          <input id="bouwjaar" name="bouwjaar" class="form-control" readonly>
        </div>
        <div class="col-md-5">
          <label class="form-label">Klant naam</label>
          <input name="klantnaam" class="form-control">
        </div>
        <div class="col-md-4">
          <label class="form-label">Klant e‑mail</label>
          <input name="klantemail" type="email" class="form-control" placeholder="klant@domein.nl">
        </div>
        <div class="col-md-4">
          <label class="form-label">Telefoon</label>
          <input name="telefoon" class="form-control">
        </div>
        <div class="col-md-4">
          <label class="form-label">Eigen e‑mail (From)</label>
          <input name="senderemail" class="form-control" placeholder="noreply@jouwdomein.nl">
        </div>
        <div class="col-md-4">
          <label class="form-label">Interne e‑mail(s)</label>
          <input name="receiveremail" class="form-control" placeholder="werkplaats@domein.nl, administratie@domein.nl">
        </div>
        <div class="col-12">
          <label class="form-label">Opmerkingen</label>
          <textarea name="opmerkingen" class="form-control" rows="4"></textarea>
        </div>
      </div>
      <div class="mt-3 d-flex gap-2">
        <button class="btn btn-success" type="submit">Versturen</button>
      </div>
    </form>
  </div>
  <div class="text-center mt-3">
    <a class="btn btn-outline-secondary" href="/admin" target="_blank">Open Admin</a>
  </div>
</div>

<script>
const kentekenEl=document.getElementById('kenteken');
document.getElementById('rdw-btn').addEventListener('click', async (e)=>{
  e.preventDefault();
  const raw=(kentekenEl.value||'').trim();
  if(!raw){ alert('Vul eerst een kenteken in.'); return; }
  try{
    const r=await fetch('/rdw?kenteken='+encodeURIComponent(raw.replace(/[^A-Za-z0-9]/g,'')));
    const d=await r.json();
    if(d && d.success){
      document.getElementById('merk').value=d.merk||'';
      document.getElementById('type').value=d.type||'';
      document.getElementById('bouwjaar').value=d.bouwjaar||'';
    } else { alert(d.message || 'Geen gegevens.'); }
  }catch(_){ alert('RDW fout.'); }
});
</script>
</body>
</html>
